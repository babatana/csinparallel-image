# Add CSinParallel

- name: Add CSinParallel
  become: yes
  unarchive:
    remote_src: yes
    src: http://csinparallel.cs.stolaf.edu/CSinParallel.tar.gz
    dest: /etc/skel

- name: Add CSinParallel to pi user
  become: yes
  unarchive:
    remote_src: yes
    src: http://csinparallel.cs.stolaf.edu/CSinParallel.tar.gz
    dest: /home/pi
    owner: pi
    group: pi



# PiTracker cron job

- name: Create PiTracker cron job
  become: yes
  cron:
    job: "/usr/bin/hd-image update"
    hour: 5
    minute: 0
    name: "PiTracker"



# bashrc

- name: Find all bashrc files
  become: yes
  shell: find /home /etc/skel -name .bashrc
  register: bashrc

- name: Update check
  become: yes
  lineinfile:
    path: "{{ bashrc_file }}"
    line: "if [ -e /usr/HD/.updated ]; then cowsay HD Image has been updated to v$(cat /usr/HD/version); rm /usr/HD/.updated; fi;"
  with_items: "{{ bashrc.stdout_lines }}"
  loop_control:
    loop_var: bashrc_file

- name: /etc/owner check (None)
  become: yes
  lineinfile:
    path: "{{ bashrc_file }}"
    line: "NAME=`cat /etc/owner`; if [[ $NAME == \"None\" ]]; then echo \"/etc/owner still contains \\\"None\\\". Please update it by running\"; echo \"    echo username > /etc/owner\"; echo \"(where username is your username)\"; fi"
  with_items: "{{ bashrc.stdout_lines }}"
  loop_control:
    loop_var: bashrc_file

- name: /etc/owner check (username)
  become: yes
  lineinfile:
    path: "{{ bashrc_file }}"
    line: "NAME=`cat /etc/owner`; if [[ $NAME == \"username\" ]]; then echo \"/etc/owner contains \\\"username\\\". We don't believe this is a valid username.\"; echo \"Please update it by running\"; echo \"    echo username > /etc/owner\"; echo \"(where username is YOUR username)\"; fi"
  with_items: "{{ bashrc.stdout_lines }}"
  loop_control:
    loop_var: bashrc_file


# Version Update

- name: Update version
  import_tasks: ../update_version.yaml
  vars:
    version: '3.0.2'