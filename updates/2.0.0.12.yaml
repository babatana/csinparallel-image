- name: Add hd-image.bash
  become: yes
  copy:
    src: files/hd-image.bash
    dest: /usr/share/HD/hd-image.bash
    owner: root
    mode: "0777"

- name: Install hd-image
  become: yes
  file:
    src: /usr/share/HD/hd-image.bash
    path: /usr/bin/hd-image
    state: link

- name: Update PiTracker service
  become: yes
  replace:
    path: /lib/systemd/system/PiTracker.service
    regexp: "ExecStart=/usr/share/HD/PiTracker.bash"
    replace: "ExecStart=/usr/bin/hd-image --update"

- name: Update PiTracker service
  become: yes
  replace:
    path: /lib/systemd/system/PiTracker.service
    regexp: "Description=Report Pi Tracking Data to CS Server"
    replace: "Description=Check for image updates and report to PiTracker server"

- name: Restart PiTracker
  become: yes
  systemd:
    name: PiTracker.service
    daemon-reload: yes
    enabled: yes
    state: restarted
